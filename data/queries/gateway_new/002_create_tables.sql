CREATE TABLE IF NOT EXISTS client( id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1), auth_token_for_proxy text, created_at timestamp without time zone, failure_email character varying(255) COLLATE pg_catalog."default", password character varying(255) COLLATE pg_catalog."default", updated_at timestamp without time zone, client_name character varying(255) COLLATE pg_catalog."default", CONSTRAINT client_pkey PRIMARY KEY (id), CONSTRAINT uk_4m08vfscy1xbsmkfng01dswot UNIQUE (client_name) );

CREATE TABLE IF NOT EXISTS event( id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1), created_at timestamp without time zone, event_name character varying(255) COLLATE pg_catalog."default", updated_at timestamp without time zone, CONSTRAINT event_pkey PRIMARY KEY (id) );

CREATE TABLE IF NOT EXISTS publisher_queue_info( id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1), event_name character varying(255) COLLATE pg_catalog."default", exchange character varying(255) COLLATE pg_catalog."default", queue_name character varying(255) COLLATE pg_catalog."default", reply_to_routing_key character varying(255) COLLATE pg_catalog."default", routing_key character varying(255) COLLATE pg_catalog."default", CONSTRAINT publisher_queue_info_pkey PRIMARY KEY (id) );

CREATE TABLE IF NOT EXISTS event_client( id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1), client_id bigint, event_id bigint, CONSTRAINT event_client_pkey PRIMARY KEY (id) );

ALTER TABLE event_client ADD COLUMN if not exists response_type varchar(255);

update event_client set response_type = 'SIMPLE_JSON_RESPONSE';

CREATE TABLE IF NOT EXISTS subscriber_url( id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1), created_at timestamp without time zone, is_enabled boolean, updated_at timestamp without time zone, url character varying(255) COLLATE pg_catalog."default", event_client_id bigint, CONSTRAINT subscriber_url_pkey PRIMARY KEY (id), CONSTRAINT fkfbpdbs8quj2ak9nwuyfo2wb6c FOREIGN KEY (event_client_id) REFERENCES event_client (id) MATCH SIMPLE ON UPDATE NO ACTION ON DELETE NO ACTION );

CREATE TABLE IF NOT EXISTS client_requests( id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1), callback_response_code integer, created_at timestamp without time zone, delivered_at timestamp without time zone, ref_id_delivered_at timestamp without time zone, request_data text COLLATE pg_catalog."default", response_data text COLLATE pg_catalog."default", result_delivered boolean, client_id bigint, event_id bigint, subscriber_url_id bigint, CONSTRAINT client_requests_pkey PRIMARY KEY (id), CONSTRAINT fk9ouyk0lntioyuegxclmbxbh7b FOREIGN KEY (event_id) REFERENCES event (id) MATCH SIMPLE ON UPDATE NO ACTION ON DELETE NO ACTION, CONSTRAINT fkh52n0q3ehtp271cnt5l1449p9 FOREIGN KEY (subscriber_url_id) REFERENCES subscriber_url (id) MATCH SIMPLE ON UPDATE NO ACTION ON DELETE NO ACTION, CONSTRAINT fksojqx4mw0vkgkih79y8shqwnh FOREIGN KEY (client_id) REFERENCES client (id) MATCH SIMPLE ON UPDATE NO ACTION ON DELETE NO ACTION );

CREATE TABLE IF NOT EXISTS client_requests_archive( id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1), callback_response_code integer, client_id bigint, client_request_id bigint, created_at timestamp without time zone, delivered_at timestamp without time zone, event_id bigint, ref_id_delivered_at timestamp without time zone, request_data text COLLATE pg_catalog."default", response_data text COLLATE pg_catalog."default", result_delivered boolean, subscriber_url_id bigint, CONSTRAINT client_requests_archive_pkey PRIMARY KEY (id) );

CREATE TABLE IF NOT EXISTS client_authentication( id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1), credentials character varying(255) COLLATE pg_catalog."default", credential_type character varying(255) COLLATE pg_catalog."default", type integer, type_id bigint, CONSTRAINT client_authentication_pkey PRIMARY KEY (id) );

create table if not exists outgoing_webhook_log( id bigserial not null, created_at timestamp, result_delivered boolean, client_id bigint, event_id bigint, subscriber_url_id bigint, data text, response text, delivered_at timestamp, callback_response_code INTEGER, updated_at timestamp, primary key (id));
